<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lịch Mượn KGHT</title>
    
    <!-- 1. CÁC THƯ VIỆN CẦN THIẾT (Load từ CDN) -->
    <!-- Tailwind CSS để style nhanh -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM để chạy logic -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel để trình duyệt hiểu được code React ngay trong file HTML -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Fonts chữ đẹp -->
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    
    <!-- Style bổ sung -->
    <style>
        body { font-family: 'Lato', sans-serif; background-color: #f5f5f0; }
        .font-serif { font-family: 'Playfair Display', serif; }
        .book-shadow { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06), 5px 0 15px -5px rgba(0,0,0,0.1); }
        
        /* Thanh cuộn đẹp cho Popup */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #d6d3d1; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #a8a29e; }
        
        /* Hiệu ứng hiện Popup */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in-up { animation: fadeIn 0.4s ease-out forwards; }
    </style>
</head>
<body>
    <!-- Nơi React sẽ hiển thị giao diện -->
    <div id="root"></div>

    <!-- 2. MÃ NGUỒN CHÍNH (JAVASCRIPT/REACT) -->
    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- CẤU HÌNH (BẠN SỬA Ở ĐÂY) ---
        const GOOGLE_FORM_URL = "https://docs.google.com/forms/d/e/1FAIpQLSfur8WRS8IWb2mOV2Px9zIeIZwLstfeuBFv_bRCLKRXhf1yYA/viewform"; // Thay link form của bạn
        const API_URL = "https://script.google.com/macros/s/AKfycbyXCACVZ5XJve5-PJV4sDTFsHaK-lF0oYLJqFnJyUyksBV211uWg9PalhU4hlWr2urAMQ/exec"; // Dán link Web App URL từ Bước 1 (Google Apps Script) vào giữa 2 dấu ngoặc kép

        // Bộ Icon (SVG) - Tích hợp sẵn để không cần file ngoài
        const Icons = {
            ChevronLeft: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m15 18-6-6 6-6"/></svg>,
            ChevronRight: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m9 18 6-6-6-6"/></svg>,
            BookOpen: () => <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>,
            Check: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>,
            X: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
            ScrollText: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M15 12h-5"/><path d="M15 8h-5"/><path d="M19 17V5a2 2 0 0 0-2-2H4"/><path d="M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3"/></svg>,
            Info: () => <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>,
            ProfileImage:() =><img src="/.AVA.png" alt="User Profile" width={64} height={64} />
            
        };

        const App = () => {
            const [currentDate, setCurrentDate] = useState(new Date());
            const [bookings, setBookings] = useState({});
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            
            // State hiển thị popup (Mặc định là true để hiện ngay khi vào web)
            const [showRules, setShowRules] = useState(true);

            // Dữ liệu giả lập (Chạy khi chưa có API)
            const mockBookings = {
                "2023-10-15": "Nguyễn Văn A",
                "2023-10-20": "Trần Thị B",
                "2023-11-05": "Câu lạc bộ Sách",
                "2023-11-12": "Nhóm Đọc Hiểu",
            };

            useEffect(() => {
                fetchData();
            }, []);

            const fetchData = async () => {
                if (!API_URL) {
                    // console.log("Chưa có API, dùng dữ liệu mẫu");
                    setLoading(true);
                    setTimeout(() => { setBookings(mockBookings); setLoading(false); }, 800);
                    return;
                }
                setLoading(true);
                try {
                    const response = await fetch(API_URL);
                    const data = await response.json();
                    const bookingMap = {};
                    data.forEach(item => {
                        const dateKey = item.date.split('T')[0]; 
                        bookingMap[dateKey] = item.occupant;
                    });
                    setBookings(bookingMap);
                } catch (err) {
                    console.error(err);
                    setError("Không thể tải dữ liệu.");
                } finally {
                    setLoading(false);
                }
            };

            const getDaysInMonth = (year, month) => new Date(year, month + 1, 0).getDate();
            const getFirstDayOfMonth = (year, month) => new Date(year, month, 1).getDay();
            
            const handlePrevMonth = () => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1));
            const handleNextMonth = () => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1));
            
            const formatDateKey = (year, month, day) => {
                const m = String(month + 1).padStart(2, '0');
                const d = String(day).padStart(2, '0');
                return `${year}-${m}-${d}`;
            };

            const handleDateClick = (day, isOccupied, occupantName) => {
                if (isOccupied) {
                    alert(`Phòng đã được mượn bởi: ${occupantName}`);
                } else {
                    window.open(GOOGLE_FORM_URL, '_blank');
                }
            };

            const renderCalendar = () => {
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();
                const daysInMonth = getDaysInMonth(year, month);
                const firstDay = getFirstDayOfMonth(year, month);
                const days = [];
                const weekDays = ['CN', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7'];

                weekDays.forEach(day => days.push(
                    <div key={`header-${day}`} className="font-bold text-cyan-700 text-center py-3 text-xs uppercase tracking-widest">{day}</div>
                ));
                for (let i = 0; i < firstDay; i++) days.push(<div key={`empty-${i}`} className="h-24 bg-cyan-50/30"></div>);

                for (let day = 1; day <= daysInMonth; day++) {
                    const dateKey = formatDateKey(year, month, day);
                    const occupant = bookings[dateKey];
                    const isOccupied = !!occupant;
                    days.push(
                        <div key={dateKey} onClick={() => handleDateClick(day, isOccupied, occupant)}
                            className={`h-24 p-2 relative cursor-pointer transition-all duration-300 border border-gray-100 ${isOccupied ? 'bg-red-50 hover:bg-red-100 group' : 'bg-white hover:bg-emerald-50 hover:-translate-y-1 hover:shadow-lg z-10'}`}>
                            <span className={`text-xl  font-bold block mb-1 ${isOccupied ? 'text-red-900 opacity-70' : 'text-cyan-700'}`}>{day}</span>
                            {isOccupied ? (
                                <div className="flex flex-col h-full justify-between pb-6">
                                    <span className="text-[10px] font-bold text-red-800 uppercase tracking-wide">Đã kín</span>
                                    <div className="absolute bottom-2 right-2 text-red-200"><Icons.X /></div>
                                </div>
                            ) : (
                                <div className="h-full flex flex-col justify-end opacity-0 hover:opacity-100 transition-opacity duration-300">
                                    <span className="text-[10px] font-bold text-emerald-700 uppercase tracking-wide mb-1">Đặt phòng</span>
                                    <div className="absolute bottom-2 right-2 text-emerald-200"><Icons.Check /></div>
                                </div>
                            )}
                        </div>
                    );
                }
                return days;
            };

            const monthNames = ["Tháng 1", "Tháng 2", "Tháng 3", "Tháng 4", "Tháng 5", "Tháng 6", "Tháng 7", "Tháng 8", "Tháng 9", "Tháng 10", "Tháng 11", "Tháng 12"];
            
            return (
                <div className="min-h-screen py-12 px-4 sm:px-6 lg:px-8 relative">
                    {/* --- POPUP QUY ĐỊNH (MODAL) --- */}
                    {showRules && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-cyan-900/60 backdrop-blur-sm transition-opacity duration-300">
                            <div className="bg-white w-full max-w-2xl max-h-[85vh] rounded-xl shadow-2xl flex flex-col overflow-hidden animate-fade-in-up border border-gray-200">
                                <div className="bg-cyan-800 p-6 flex items-center justify-between shrink-0">
                                    <div className="flex items-center space-x-3">
                                        <div className="text-amber-100"><Icons.ScrollText /></div>
                                        <h2 className="text-xl font-serif font-bold text-white tracking-wide">QUY ĐỊNH MƯỢN KHÔNG GIAN</h2>
                                    </div>
                                </div>
                                <div className="p-6 overflow-y-auto custom-scrollbar text-cyan-700 space-y-6 text-sm leading-relaxed">
                                    <div className="text-center font-bold text-base border-b border-gray-200 pb-2 mb-4">QUY ĐỊNH MƯỢN KHÔNG GIAN HỌC THUẬT</div>
                                    <section>
                                        <h3 className="font-bold text-cyan-900 mb-2 uppercase text-xs tracking-wider">I. Thông tin:</h3>
                                        <ul className="list-disc pl-5 space-y-1 marker:text-gray-400">
                                            <li>Không Gian Học Thuật bên cạnh được dùng cho sinh viên sử dụng để học tập, thảo luận theo nhóm thì còn được dùng như một không gian riêng dành cho các CLB – Đội – Nhóm các cấp.</li>
                                            <li>
                                                Khung giờ mượn/trả: 
                                                <ul>
                                                    <li><span className="font-semibold">T2 – T7: 17:30 đến 20:00 </span>.</li>
                                                     <li><span className="font-semibold"> CN: 8:00 - 20:00</span>.</li>
                                                </ul>
                                            </li>
                                            
                                            <li>Mục đích: Hội họp, học tập nội bộ...</li>
                                        </ul>
                                    </section>
                                    <section>
                                        <h3 className="font-bold text-cyan-900 mb-2 uppercase text-xs tracking-wider">II. Quy định:</h3>
                                        <ul className="list-disc pl-5 space-y-1 marker:text-gray-400">
                                            <li>Đăng ký trước ít nhất <span className="font-semibold">3 ngày</span>.</li>
                                            <li>Nếu xong sớm hơn dự kiến, báo trước 30 phút.</li>
                                            <li>Trả lại hiện trạng bàn ghế sau khi sử dụng.</li>
                                            <li>Giữ gìn vệ sinh, không mang đồ ăn có mùi.</li>
                                            <li>Không động vào tài sản của CLB Bồ Câu Xanh.</li>
                                        </ul>
                                    </section>
                                    <section>
                                        <h3 className="font-bold text-cyan-900 mb-2 uppercase text-xs tracking-wider">III. Xử lý vi phạm:</h3>
                                        <ul className="list-disc pl-5 space-y-1 marker:text-gray-400">
                                            <li><span className="font-semibold">Lần 1:</span> Nhắc nhở.</li>
                                            <li><span className="font-semibold">Lần 2:</span> Cấm mượn 2 tháng.</li>
                                            <li><span className="font-semibold">Lần 3:</span> Cấm mượn trong học kỳ.</li>
                                        </ul>
                                    </section>
                                    <div className="text-right pt-4 text-cyan-700 italic ">Trưởng ban Hậu Cần – Nhân Sự<br/><span className="font-bold not-italic text-cyan-800">Phạm Phúc An</span></div>
                                </div>
                                <div className="p-4 bg-cyan-50 border-t border-gray-200 flex justify-center shrink-0">
                                    <button onClick={() => setShowRules(false)} className="bg-cyan-800 hover:bg-cyan-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transform transition hover:scale-105 active:scale-95 flex items-center space-x-2">
                                        <div className="text-white"><Icons.Check /></div><span>TÔI ĐỒNG Ý</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* --- GIAO DIỆN CHÍNH (LỊCH) --- */}
                    <div className={`max-w-5xl mx-auto transition-filter duration-300 ${showRules ? 'blur-sm' : ''}`}>
                        <div className="text-center mb-12 space-y-4">
                            <div className="inline-flex items-center justify-center p-0.25 bg-cyan-800 rounded-full shadow-2xl mb-4"><div className="text-cyan-50">
                               <Icons.ProfileImage/>
                                </div></div>
                            <h1 className="text-5xl md:text-6xl font-serif font-bold text-cyan-900 tracking-tight">KHÔNG GIAN HỌC THUẬT</h1>
                            <p className="text-xl text-cyan-700 font-serif italic">"Nơi thời gian ngừng lại bên trang sách"</p>
                            <button onClick={() => setShowRules(true)} className="text-xs text-gray-400 hover:text-cyan-700 underline flex items-center justify-center w-full mt-2"><span className="mr-1"><Icons.Info /></span> Xem lại quy định</button>
                        </div>

                        <div className="bg-white rounded-lg shadow-xl overflow-hidden border border-gray-200">
                            <div className="bg-cyan-900 p-8 text-cyan-50 flex justify-between items-center">
                                <button onClick={handlePrevMonth} className="p-3 hover:bg-cyan-700 rounded-full transition-all active:scale-95"><Icons.ChevronLeft /></button>
                                <div className="flex flex-col items-center">
                                    <span className="text-3xl font-serif font-medium tracking-wide">{monthNames[currentDate.getMonth()]}</span>
                                    <span className="text-gray-400 font-light mt-1">{currentDate.getFullYear()}</span>
                                </div>
                                <button onClick={handleNextMonth} className="p-3 hover:bg-cyan-700 rounded-full transition-all active:scale-95"><Icons.ChevronRight /></button>
                            </div>

                            {loading && <div className="p-12 text-center text-gray-400 italic animate-pulse">Đang cập nhật dữ liệu...</div>}
                            {error && <div className="bg-red-50 p-4 text-center text-red-600 text-sm border-b border-red-100">{error}</div>}
                            
                            {!loading && <div className="grid grid-cols-7 bg-gray-100 gap-px border-b border-gray-200">{renderCalendar()}</div>}
                            
                            <div className="p-6 bg-cyan-50 border-t border-gray-100 flex justify-center space-x-12 text-sm text-cyan-700 font-medium">
                                <div className="flex items-center"><div className="w-3 h-3 bg-white border border-cyan-300 mr-3 shadow-sm"></div><span>Còn trống</span></div>
                                <div className="flex items-center"><div className="w-3 h-3 bg-red-50 border border-red-200 mr-3 shadow-sm"></div><span>Đã được mượn</span></div>
                            </div>
                        </div>
                        <div className="text-center mt-12 text-gray-400 text-xs tracking-widest uppercase">© {new Date().getFullYear()} CLB BỒ CÂU XANH - TỦ SÁCH TRƯỜNG Y</div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

